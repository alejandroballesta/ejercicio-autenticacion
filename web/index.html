<html>

<head>

</head>

<body>
    <p id="greeting">Hello Anonymous</p>
    <p id="data">Hidden data</p>
    <button id="btn-login">Log in</button>
    <button id="btn-logout">Log out</button>
</body>
<script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
<script>
    auth0.createAuth0Client({
        domain: "dev-mjmzgyd7.us.auth0.com",
        clientId: "RrNXDsP8EEtmVXAsEK6Pt0zzcS4GgknA",
        authorizationParams: {
            redirect_uri: window.location.origin,
            audience: 'https://api-js.com/pruebas'
        }
    }).then(async (auth0Client) => {
        const btnLogin = document.getElementById('btn-login');
        const btnLogout = document.getElementById("btn-logout");

        btnLogin.addEventListener("click", (e) => {
            e.preventDefault();
            auth0Client.loginWithRedirect();
        });

        if (location.search.includes("state=") &&
            (location.search.includes("code=") ||
                location.search.includes("error="))) {
            await auth0Client.handleRedirectCallback();
            window.history.replaceState({}, document.title, "/");
        }

        btnLogout.addEventListener("click", (e) => {
            e.preventDefault();
            auth0Client.logout();
        });

        const isAuthenticated = await auth0Client.isAuthenticated();
        const userProfile = await auth0Client.getUser();

        if (isAuthenticated) {
            document.getElementById("greeting").innerHTML = `Hi ${userProfile.nickname}!`;
        }

        const token = await auth0Client.getTokenSilently();

        const req = new XMLHttpRequest();
        req.open("GET", "/api/protectedData", false);
        req.setRequestHeader("Authorization", `Bearer ${token}`);
        req.send(null);
        if (req.status === 200) {
            document.getElementById("data").innerHTML = req.responseText;
        }
    });
</script>

</html>